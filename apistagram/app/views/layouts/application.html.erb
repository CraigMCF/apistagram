<!DOCTYPE html>
<html xmlns:fb="https://www.facebook.com/2008/fbml">
  <head>
    <meta name="description" content="<%=AppConfiguration['meta_tags']%>">
    <title><%=@title || AppConfiguration['title']['default']%></title>
    <%= stylesheet_link_tag "style", :media => "all" %>
    <%=javascript_include_tag 'application'%>
    <%= csrf_meta_tags %>
  </head>
  <body>
    <%=render 'layouts/header'%>
    <%=render 'layouts/nav'%>
    <div id="container">
      <%=render 'layouts/social'%>
      <div id='notice'>
        <%if flash[:notice]%>
          <div class='notice'><%=flash[:notice]%></div>
        <%end%>
      </div>
      <%= yield %>
    </div>
    <%=render 'layouts/footer'%>

    <script>


      // $.fn.fixBroken = function(){
      //   return this.each(function(){
      //     var tag = $(this);
      //     tag.error(function() { // this adds the onerror event to images
      //       tag.attr("src", '/assets/fallback/thumb_default.png'); // change the src attribute of the image
      //       // $(tag).parents('.photoHolder').hide();
      //       // $(tag).parents('.more-thumb').hide();
      //       return true;
      //     });
      //   });
      // };


      $.fn.broken = function(){
        return this.each(function(){
          if(!this.complete || (typeof this.naturalWidth != 'undefined' && this.naturalWidth == 0)) {
            $(this).attr("src", '/assets/fallback/content_removed.gif');
            $(this).parents('.thumb:first').find('.call-text').remove();
            $(this).parents('.more-thumb').hide(); 
          }
        });
      };

      $(window).load(function () {
        $('.iImg').broken();
      });
    </script>
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-35768230-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>    
  </body>
</html>
